-------------------Variables--------------------
local Target = ""
local TargetDistance = nill
local TargetPos = Vector3.new(0,0,0)
local ShowTarget = false

local KillAura = false
local KillAuraLockTarget = false
local KillAuraAttackSpeed = 5
local KillAuraDistanceForNewTarget = 35
local KillAuraDistanceForAttack = 30
local KillAuraRandomDelay = true




-------------------Functions--------------------

local function getDistance(pos1X,pos1Y,pos1Z,pos2X,pos2Y,pos2Z)
    local DistanceX = math.abs(pos1X-pos2X)
    local DistanceY = math.abs(pos1Y-pos2Y)
    local DistanceZ = math.abs(pos1Z-pos2Z)

    local Distance = ((DistanceX^2)+(DistanceY^2)+(DistanceZ^2))^0.5
    return Distance
end

local function SetPart(Name,Trans,SizeX,SizeY,SizeZ,Posx,Posy,Posz,cancolide)
	local Part = Instance.new("Part",game:GetService("Workspace"))
	Part.Name = Name
	Part.Anchored = true
	Part.Transparency = Trans
	Part.Size = Vector3.new(SizeX,SizeY,SizeZ)
	Part.Position = Vector3.new(Posx,Posy,Posz)
	Part.CanCollide = cancolide
	Part.TopSurface = "Smooth"
	Part.BottomSurface = "Smooth"
    return Part
end

function GetNewTargetFunc()
    spawn(function()

        local NewTarget = "Nill"
        local NewTargetDistance = 0
        local NewTargetPos = Vector3.new(0,0,0)

        local Players = game:GetService("Players")
        local Player = Players.LocalPlayer
        local WorkSpace = game:GetService("Workspace")
        
        if WorkSpace:FindFirstChild(Player.Name) then
            local PlayerW = WorkSpace:FindFirstChild(Player.Name)
            local PlayerHumanoidPos = PlayerW.HumanoidRootPart.Position
            for i, v in pairs(Players:GetChildren()) do
                local canCheckPlayer = true
                if v.Name == Player.Name then
                    canCheckPlayer = false
                end
                if canCheckPlayer then
                    if NewTarget == "Nill" then

                        if WorkSpace:FindFirstChild(v.Name) then
                            if WorkSpace:FindFirstChild(v.Name):FindFirstChild("HumanoidRootPart") then
                                local TargetHRP = WorkSpace:FindFirstChild(v.Name).HumanoidRootPart
                                NewTarget = v.Name
                                NewTargetDistance = getDistance(
                                    TargetHRP.Position.X,TargetHRP.Position.Y,TargetHRP.Position.Z,
                                    PlayerHumanoidPos.X,PlayerHumanoidPos.Y,PlayerHumanoidPos.Z
                                )
                                NewTargetPos = TargetHRP.Position
                            end
                        end

                    else

                        if WorkSpace:FindFirstChild(v.Name) then
                            if WorkSpace:FindFirstChild(v.Name):FindFirstChild("HumanoidRootPart") then
                                local TarP = WorkSpace:FindFirstChild(v.Name):FindFirstChild("HumanoidRootPart").Position
                                local TarD = getDistance(
                                    PlayerHumanoidPos.X,PlayerHumanoidPos.Y,PlayerHumanoidPos.Z,
                                    TarP.X,TarP.Y,TarP.Z
                                )
                                if TarD<NewTargetDistance then
                                    NewTarget = v.Name
                                    NewTargetDistance = TarD
                                    NewTargetPos = TarP
                                end
                            end
                        end

                    end
                end
                
            end

        end

        Target = NewTarget
        TargetDistance = NewTargetDistance
        TargetPos = NewTargetPos
    end)
end

function ShowTargetFunc()
    spawn(function()
        local WorkSpace = game:GetService("Workspace")

        local Part = SetPart("ShowTargetPart",1,3.5,1,3.5,1,1,1,false)

        local serviceGui = Instance.new("SurfaceGui",Part)
        serviceGui.Name = "Ok"
        serviceGui.AlwaysOnTop = true
        serviceGui.CanvasSize = Vector2.new(300,50)
        serviceGui.PixelsPerStud = 50
        serviceGui.Face = "Front"

        local Frame = Instance.new("Frame",serviceGui)
        Frame.Size = UDim2.new(0,300,0,50)
        Frame.BackgroundColor3 = Color3.new(0.690196, 0.141176, 0.141176)

        local serviceGui = Instance.new("SurfaceGui",Part)
        serviceGui.Name = "Ok"
        serviceGui.AlwaysOnTop = true
        serviceGui.CanvasSize = Vector2.new(300,50)
        serviceGui.PixelsPerStud = 50
        serviceGui.Face = "Back"

        local Frame = Instance.new("Frame",serviceGui)
        Frame.Size = UDim2.new(0,300,0,50)
        Frame.BackgroundColor3 = Color3.new(0.690196, 0.141176, 0.141176)

        local serviceGui = Instance.new("SurfaceGui",Part)
        serviceGui.Name = "Ok"
        serviceGui.AlwaysOnTop = true
        serviceGui.CanvasSize = Vector2.new(300,50)
        serviceGui.PixelsPerStud = 50
        serviceGui.Face = "Right"

        local Frame = Instance.new("Frame",serviceGui)
        Frame.Size = UDim2.new(0,300,0,50)
        Frame.BackgroundColor3 = Color3.new(0.690196, 0.141176, 0.141176)

        local serviceGui = Instance.new("SurfaceGui",Part)
        serviceGui.Name = "Ok"
        serviceGui.AlwaysOnTop = true
        serviceGui.CanvasSize = Vector2.new(300,50)
        serviceGui.PixelsPerStud = 50
        serviceGui.Face = "Left"

        local Frame = Instance.new("Frame",serviceGui)
        Frame.Size = UDim2.new(0,300,0,50)
        Frame.BackgroundColor3 = Color3.new(0.690196, 0.141176, 0.141176)

        while ShowTarget do
            if WorkSpace:FindFirstChild(Target) and WorkSpace:FindFirstChild(Target):FindFirstChild("HumanoidRootPart") then
                Part.Position = WorkSpace:FindFirstChild(Target).HumanoidRootPart.Position
            end
            wait(0.3)
        end
        Part:Destroy()
    end)
end

function KillAuraFunc()
    spawn(function()
        GetNewTargetFunc()

        local WorkSpace = game:GetService("Workspace")
        local Players = game:GetService("Players")
        local Player = Players.LocalPlayer

        while KillAura do
            if WorkSpace:FindFirstChild(Player.Name) and WorkSpace:FindFirstChild(Player.Name):FindFirstChild("HumanoidRootPart") then
                if WorkSpace:FindFirstChild(Target) then
                else
                    GetNewTargetFunc()
                end

                local CanAttack = true
                local PLayerW = Player.Character:FindFirstChild(Player.Name)
                local PlayerWPosition = PlayerW.HumanoidRootPart.Position
                local DistaceFromTarget = getDistance(
                    PlayerWPosition.X,PlayerWPosition.Y,PlayerWPosition.Z,
                    TargetPos.X,TargetPos.Y,TargetPos.Z
                )
                if KillAuraDistanceForAttack < DistaceFromTarget then
                    CanAttack = false
                end
                if KillAuraDistanceForNewTarget < DistaceFromTarget then
                    CanAttack = false
                    GetNewTargetFunc()
                end

                if CanAttack == true then
                    local args = {
                        [1] = game:GetService("Players"):FindFirstChild(Target).Character
                    }
                    
                    game:GetService("ReplicatedStorage").GameRemotes.Attack:InvokeServer(unpack(args))
                end

                wait(KillAuraAttackSpeed/10)
                if KillAuraRandomDelay then
                    wait(math.random(4,8)/16)
                end
            end
        end
    end)
end

function FindChestFunc()
    spawn(function()
        local WorkSpace = game:GetService("Workspace")
        local Blocks = WorkSpace.Blocks
        local ChestTable = {}
        for i, v in pairs(Blocks:GetChildren()) do
            for ii ,vv in pairs(v:GetChildren()) do
                if vv.Name == "Chest" then
                    ChestTableCount = ChestTableCount + 1
                    ChestTable[vv.Position] = "x ".. vv.Position.X/3 .." "
                end
            end
        end



    end)
end

-------------------gui--------------------------
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/xHeptc/Kavo-UI-Library/main/source.lua"))()

local Window = Library.CreateLib("MinersCave by Deloads", "BloodTheme")

local CombadTab = Window:NewTab("Combad")

local TargetSection = CombadTab:NewSection("Target")

local TargetNameLabel = TargetSection:NewLabel("TargetName")

local UpdateTargetName = false
function UpdateTargetNameFunc()
    spawn(function()
        while UpdateTargetName do
            wait(0.5)
            TargetNameLabel:UpdateLabel(Target)
        end
    end)
end

TargetSection:NewToggle("UpDate Target Name", "ToggleInfo", function(state)
    UpdateTargetName = state
    UpdateTargetNameFunc()
end)

TargetSection:NewButton("Find New Target", "ButtonInfo", function()
    GetNewTargetFunc()
end)

local Playerdropdown = TargetSection:NewDropdown("Select Target","Info",{}, function(selected)
    Target = selected
end)

TargetSection:NewToggle("ShowTarget", "ToggleInfo", function(state)
    ShowTarget = state
    ShowTargetFunc()
end)

local KillAuraSection = CombadTab:NewSection("KillAura")

KillAuraSection:NewToggle("KillAura", "ToggleInfo", function(state)
    KillAura = state
    KillAuraFunc()
end)

KillAuraSection:NewToggle("Lock on Target", "ToggleInfo", function(state)
    KillAuraLockTarget = state
end)

KillAuraSection:NewToggle("Add short delay", "ToggleInfo", function(state)
    KillAuraRandomDelay = state
end)

KillAuraSection:NewSlider("Atack Speed", "SliderInfo", 10, 1, function(s) -- 500 (MaxValue) | 0 (MinValue)
    KillAuraAttackSpeed = s
end)

KillAuraSection:NewSlider("Distance for new Target", "SliderInfo", 60, 15, function(s) -- 500 (MaxValue) | 0 (MinValue)
    KillAuraDistanceForNewTarget = s
end)

KillAuraSection:NewSlider("Max Distance For Atack", "SliderInfo", 35, 0, function(s) -- 500 (MaxValue) | 0 (MinValue)
    KillAuraDistanceForAttack = s
end)

--Player Added or removes

local Players = game:GetService("Players")

local function UpdateDropDown()
    local tab = {}
    for i, v in pairs(game:GetService("Players"):GetChildren()) do
        tab[i] = v.Name
    end
    Playerdropdown:Refresh(tab)
end
UpdateDropDown()
Players.PlayerAdded:Connect(function(Player)
    UpdateDropDown()
end)

Players.PlayerRemoving:Connect(function(Player)
    UpdateDropDown()
end)